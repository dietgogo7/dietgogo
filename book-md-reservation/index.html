<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>도서 MD 미팅 예약</title>
    <link rel="stylesheet" href="css/app.css">
</head>

<body>
    <div id="app">
        <!-- 최상단 중앙 로고 -->
        <div class="top-logo">
            <img src="https://image.yes24.com/sysimage/renew/gnb/logoN4.svg" alt="yes24.com 로고" class="yes24-logo">
        </div>

        <header class="main-header">
            <div class="header-branding">
                <!-- 마스코드: 텍스트 왼쪽으로 이동 -->
                <img src="https://image.yes24.com/sysimage/mv3/com/ico_ai02.svg" alt="마스코드" class="mascode">

                <div class="header-copy">
                    <small class="eyebrow">YOUR · EVERY · STORY</small>
                    <h1>MD 미팅 예약시스템</h1>
                </div>
            </div>
            <div class="header-meta">
                <small>예약 내역은 휴대폰번호로 확인 가능 합니다.</small>
                <a href="#" class="my-bookings-link" onclick="openMyBookingsPopup()">예약 내역 조회</a>
            </div>
        </header>
        <main>
            <section class="card">
                <div class="card-header">
                    <h2>안내사항</h2>
                    <small>MD 미팅 예약 전 아래 내용을 확인해주세요.</small>
                </div>
                <div class="info-body">
                    <div class="info-item">
                        <strong>미팅 시간</strong>
                        <p>월 ~ 목 14:00 - 15:30 (회차별 15분 / 일 6회)</p>
                    </div>
                    <div class="info-item">
                        <strong>미팅 예약</strong>
                        <p>일주일 전부터 가능하며, 분야별 1일 6회로 제한됩니다.</p>
                    </div>
                    <div class="info-item">
                        <strong>예약 확정</strong>
                        <p>확인 문자(메일) 수신 시 예약이 완료됩니다.<br>
                            <span>확정된 내역은 '예약 내역 조회' 페이지에서 확인 가능합니다.</span>
                        </p>
                    </div>
                    <div class="info-item">
                        <strong>기타 안내</strong>
                        <p>미팅 신청은 선착순 마감되며 MD의 일정에 따라 취소 후 안내될 수 있습니다. 예약이 어려우신 경우, 이메일로 업무 내용을 보내주세요.</p>
                    </div>
                </div>
            </section>
            <section class="notice-card card">
                <div class="card-header">
                    <h2>공지사항</h2>
                </div>
                <div id="notice-alert-container" style="display:none;">
                    <div id="front-notice-list"></div>
                </div>
            </section>
            <section class="flow-card card">
                <div class="card-header">
                    <h2>예약 플로우</h2>
                    <small>‘MD 먼저’와 ‘날짜 먼저’를 자유롭게 전환하세요.</small>
                </div>
                <div class="flow-selector">
                    <button id="select-flow-md" class="flow-btn active">MD 먼저 선택</button>
                    <button id="select-flow-date" class="flow-btn">날짜 먼저 선택</button>
                </div>
                <div class="flow-grid">
                    <!-- Flow 1: MD First -->
                    <div id="flow-md-first" class="flow-container">
                        <!-- Step 1: MD Select -->
                        <div id="md-list-container-1" class="selection-area active">
                            <div class="step-progress-wrap">
                                <div class="step-progress-dots">
                                    <div class="progress-dot active"></div>
                                    <div class="progress-dot"></div>
                                    <div class="progress-dot"></div>
                                </div>
                            </div>
                            <div class="step-nav-header">
                                <h3>MD를 선택해주세요.</h3>
                            </div>
                            <div class="list-wrapper"></div>
                        </div>

                        <!-- Step 2: Date Select -->
                        <div id="date-selector-container-1" class="selection-area">
                            <div class="step-progress-wrap">
                                <div class="step-progress-dots">
                                    <div class="progress-dot active"></div>
                                    <div class="progress-dot active"></div>
                                    <div class="progress-dot"></div>
                                </div>
                            </div>
                            <div class="step-nav-header">
                                <h3>날짜를 선택해주세요.</h3>
                                <div class="step-nav-btns">
                                    <button class="btn-step-prev"
                                        onclick="goToStep('md-list-container-1', 'flow-md-first')">이전</button>
                                </div>
                            </div>
                            <div id="calendar-container-1" class="calendar-container"></div>
                        </div>

                        <!-- Step 3: Time Select -->
                        <div id="slots-area-1" class="selection-area">
                            <div class="step-progress-wrap">
                                <div class="step-progress-dots">
                                    <div class="progress-dot active"></div>
                                    <div class="progress-dot active"></div>
                                    <div class="progress-dot active"></div>
                                </div>
                            </div>
                            <div class="step-nav-header">
                                <h3>시간을 선택해주세요.</h3>
                                <div class="step-nav-btns">
                                    <button class="btn-step-prev"
                                        onclick="goToStep('date-selector-container-1', 'flow-md-first')">이전</button>
                                </div>
                            </div>
                            <div class="list-wrapper"></div>
                        </div>
                    </div>

                    <!-- Flow 2: Date First -->
                    <div id="flow-date-first" class="flow-container" style="display: none;">
                        <!-- Step 1: Date Select -->
                        <div id="date-selector-container-2" class="selection-area active">
                            <div class="step-progress-wrap">
                                <div class="step-progress-dots">
                                    <div class="progress-dot active"></div>
                                    <div class="progress-dot"></div>
                                    <div class="progress-dot"></div>
                                </div>
                            </div>
                            <div class="step-nav-header">
                                <h3>날짜를 선택해주세요.</h3>
                            </div>
                            <div id="calendar-container" class="calendar-container"></div>
                        </div>

                        <!-- Step 2: Time Select -->
                        <div id="time-selector-container-2" class="selection-area">
                            <div class="step-progress-wrap">
                                <div class="step-progress-dots">
                                    <div class="progress-dot active"></div>
                                    <div class="progress-dot active"></div>
                                    <div class="progress-dot"></div>
                                </div>
                            </div>
                            <div class="step-nav-header">
                                <h3>시간을 선택해주세요.</h3>
                                <div class="step-nav-btns">
                                    <button class="btn-step-prev"
                                        onclick="goToStep('date-selector-container-2', 'flow-date-first')">이전</button>
                                </div>
                            </div>
                            <div class="list-wrapper"></div>
                        </div>

                        <!-- Step 3: MD Select -->
                        <div id="md-list-container-2" class="selection-area">
                            <div class="step-progress-wrap">
                                <div class="step-progress-dots">
                                    <div class="progress-dot active"></div>
                                    <div class="progress-dot active"></div>
                                    <div class="progress-dot active"></div>
                                </div>
                            </div>
                            <div class="step-nav-header">
                                <h3>MD를 선택해주세요.</h3>
                                <div class="step-nav-btns">
                                    <button class="btn-step-prev"
                                        onclick="goToStep('time-selector-container-2', 'flow-date-first')">이전</button>
                                </div>
                            </div>
                            <div class="list-wrapper"></div>
                        </div>
                    </div>
                </div>
            </section>
            <section class="card" id="section-maps">
                <div class="card-header">
                    <h2>오시는 길</h2>
                </div>
                <div class="info-body">
                    <div class="info-item">
                        <strong>방문 주소</strong>
                        <p>서울시 영등포구 은행로 11 일신빌딩<br>
                            <span>지하1층 예스이십사 라운지</span>
                        </p>
                    </div>
                </div>
                <div id="map"
                    style="width:100%; height:260px; margin-top:20px; border-radius:12px; border:1px solid #e4e7ef;">
                </div>
            </section>
            <section class="card">
                <div class="card-header">
                    <h2>연락처 및 문의</h2>
                </div>
                <div class="info-body">
                    <div class="info-item">
                        <strong>전화번호</strong>
                        <p>02-3215-9xxx (내선번호 3자리 / 하단 링크 참조)</p>
                    </div>
                    <div class="info-item">
                        <strong>
                            <a href="http://www.yes24.com/company/info.aspx" target="_blank" rel="noopener noreferrer" class="site-link site-link-title">
                                예스24 사업본부 안내
                                <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
                            </a>
                        </strong>
                    </div>
                </div>
            </section>
            <div id="inline-booking-form-container" class="inline-form-slot" style="display:none;"></div>
        </main>
        <footer class="main-footer">
            <span>Copyright © YES24 Corp. All Rights Reserved.</span>
        </footer>
    </div>

    <!-- 예약 신청 레이어 템플릿 -->
    <script id="booking-template" type="text/template">
        <div class="service-card">
            <h2 class="service-title">예약 신청</h2>
            <div class="service-info" style="background:#f8fafc; padding:15px; border-radius:12px; border:1px solid #e2e8f0; margin-bottom:20px;">
                <div style="font-size:13px; color:#64748b; margin-bottom:5px;">선택한 예약 정보</div>
                <div class="service-md-wrap" style="margin-bottom:8px;">
                    <span class="service-md" style="font-size:16px;">{{MD_NAME}} MD</span>
                    <span class="service-md-cat" style="font-size:12px;">{{MD_CATEGORY}}</span>
                </div>
                <div class="service-time" style="font-size:15px; color:#1e293b; background:transparent;">
                    <span style="margin-right:5px;"></span>{{DATE}}
                    <span style="margin-left:10px; font-weight:800; color:var(--primary);">{{TIME}}</span>
                </div>
            </div>
            <form id="inline-booking-form">
                <input type="hidden" id="slot-id-input" value="{{SLOT_SEQ}}">
                <input type="hidden" id="meeting-time-input" value="{{START_DATETIME}}">
                <div class="form-group">
                    <label for="user-name">신청자 성명 <span class="required">*</span></label>
                    <input type="text" id="user-name" placeholder="성함을 입력해주세요" required>
                </div>
                <div class="form-group">
                    <label for="user-phone">휴대폰 번호 <span class="required">*</span></label>
                    <input type="tel" id="user-phone" placeholder="숫자만 입력 (예: 01012345678)" required>
                </div>
                <div class="form-group">
                    <label for="user-affiliation">출판사명 <span class="required">*</span></label>
                    <input type="text" id="user-affiliation" placeholder="출판사명을 입력해주세요" required>
                </div>
                <div class="form-group">
                    <label for="user-email">이메일 <span class="required">*</span></label>
                    <input type="email" id="user-email" placeholder="이메일 주소를 입력해주세요" required>
                </div>
                <div class="form-group">
                    <label for="notes">미팅 목적 및 내용 <span class="required">*</span></label>
                    <textarea id="notes" placeholder="미팅 목적, 주요 안건 등을 입력해주세요&#10;(예: 신간 도서 소개, 마케팅 협의 등)" required></textarea>
                </div>
                <div class="form-actions" style="margin-top:25px;">
                    <button type="submit" class="btn-primary" style="flex:1; padding:16px;">예약 신청완료</button>
                    <button type="button" id="cancel-booking" class="btn-secondary" style="padding:16px;">취소</button>
                </div>
            </form>
            <p id="form-message" class="message-area"></p>
        </div>
    </script>

    <!-- 예약 내역 조회 레이어 팝업 템플릿 -->
    <script id="my-bookings-template" type="text/template">
        <div class="modal-overlay">
            <div class="modal-dialog">
                <button type="button" class="modal-close" id="close-lookup-modal">&times;</button>
                <div class="modal-header">
                    <h2 class="modal-title">나의 예약 내역 조회</h2>
                </div>
                <div class="modal-body">
                    <p class="modal-desc">예약 시 입력한 휴대폰 번호를 입력해주세요.</p>
                    <div class="form-group">
                        <label for="lookup-phone">휴대폰 번호</label>
                        <input type="tel" id="lookup-phone" placeholder="숫자만 입력 (예: 01012345678)" maxlength="11">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-cancel" id="cancel-lookup-modal">취소</button>
                    <button type="button" class="btn-confirm" id="confirm-lookup-btn">조회하기</button>
                </div>
            </div>
        </div>
    </script>

    <!-- 제이쿼리 3.5.1 로드 -->
    <script src="https://image.yes24.com/sysimage/Contents/Scripts/m/jquery/jquery-3.5.1.min.js"></script>
    <!-- 네이버 지도 SDK 로드 -->
    <script async defer type="text/javascript"
        src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=3r1jlsgk8r&submodules=geocoder&callback=initNaverMap"></script>
    <script src="js/calendar.js"></script>
    <script src="js/app.js"></script>
    <script>
        // 전역 콜백: SDK 로드 후 자동 실행 (네이버 지도는 전역 함수 필요)
        window.initNaverMap = function () {
            if (!window.naver || !naver.maps) {
                console.error("네이버 지도 SDK 로드 실패");
                return;
            }

            var lat = 33.450701;
            var lng = 126.570667;

            var position = new naver.maps.LatLng(lat, lng);
            var map = new naver.maps.Map('map', {
                center: position,
                zoom: 17
            });

            // 마커 생성
            new naver.maps.Marker({
                position: position,
                map: map,
                icon: {
                    url: 'https://image.yes24.com/sysimage/renew/common/marker_Custom.png',
                    size: new naver.maps.Size(40, 43),
                    scaledSize: new naver.maps.Size(40, 43),
                    origin: new naver.maps.Point(0, 0),
                    anchor: new naver.maps.Point(12, 34)
                }
            });
        };

        // 렌더링 함수: 제이쿼리 방식
        function renderTimeSlotsInto(selectors, slots) {
            $.each(selectors, function (index, sel) {
                var $container = $(sel);
                if ($container.length === 0) return;
                $container.empty();

                $.each(slots, function (i, time) {
                    $('<div></div>')
                        .addClass('time-item')
                        .text(time)
                        .on('click', function () {
                            $container.find('.time-item').removeClass('selected');
                            $(this).addClass('selected');
                            console.log('선택된 시간:', time);
                        })
                        .appendTo($container);
                });
            });
        }

        // 도큐먼트 레디
        $(function () {
            // OYCalendar 유틸리티 사용
            var slots = OYCalendar.generateTimeSlots('14:00', '15:30', 15);
            renderTimeSlotsInto([
                '#slots-area-1 .list-wrapper',
                '#time-selector-container-2 .list-wrapper'
            ], slots);

        });
    </script>
</body>

</html>